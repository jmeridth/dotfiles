export EDITOR='vim'
export LANG=en_US.UTF-8

if [ -d "$HOME/.oh-my-zsh" ]; then
  export ZSH="$HOME/.oh-my-zsh"

  # See https://github.com/ohmyzsh/ohmyzsh/wiki/Themes
  ZSH_THEME="robbyrussell"

  plugins=(autoenv asdf git docker docker-compose vscode)

  # Compilation flags
  # export ARCHFLAGS="-arch x86_64"

  RPROMPT='%*'

  # Enable vi mode
  source $ZSH/oh-my-zsh.sh
fi

if command -v go >/dev/null; then
  # Set up Go env vars
  export GOPATH=$HOME/code
  export PATH=$PATH:$GOPATH/bin
  export GOTELEMETRY=off
fi

if command -v asdf >/dev/null; then
  # Set up asdf in PATH env var
  export PATH="${ASDF_DATA_DIR:-$HOME/.asdf}/shims:$PATH"
fi

# GPG
GPG_TTY=$(tty)
export GPG_TTY
if [ -f "${HOME}/.gpg-agent-info" ]; then
    source "${HOME}/.gpg-agent-info"
    export GPG_AGENT_INFO
    export SSH_AUTH_SOCK
fi

# Config git repo for work
setup_gitsign () {
  git config --local user.name "Jason Meridth"
  git config --local user.email "jason.meridth@chainguard.dev"
  git config --local commit.gpgsign true
  git config --local tag.gpgsign true
  git config --local gpg.x509.program gitsign
  git config --local gpg.format x509
  git config --local gitsign.connectorID https://accounts.google.com
}

# Config git repo for personal
setup_gitssh () {
  git config --local user.name jmeridth
  git config --local user.email "jmeridth@gmail.com"
  git config --local user.signingKey "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMqx3i3GOjjPQAOf4VXQewDvd+I1Woycv6+XW1AlHycG"
  git config --local commit.gpgsign true
  git config --local tag.gpgsign true
  git config --local gpg.ssh.program /Applications/1Password.app/Contents/MacOS/op-ssh-sign
  git config --local gpg.format ssh
}

# RUBY
export RUBY_CONFIGURE_OPTS="--with-libyaml-dir=$(brew --prefix libyaml) --with-openssl-dir=$(brew --prefix openssl@3) --disable-install-doc"

{{- if eq .chezmoi.os "darwin" }}
if ! command -v brew > /dev/null; then
HOMEBREW_PREFIX="/usr/local"
# HOMEBREW FOLDER PREFIX FOR M1
if [[ $(uname -p) == 'arm' ]]; then
HOMEBREW_PREFIX="/opt/homebrew"
fi
eval $($HOMEBREW_PREFIX/bin/brew shellenv)

# AUTOENV
if ! command -v autoenv > /dev/null; then
source $HOMEBREW_PREFIX/opt/autoenv/activate.sh
fi

export PATH="$HOMEBREW_PREFIX/opt/libpq/bin:$PATH"
fi
{{- end }}

bindkey -v
# incremental search in insert mode
bindkey "^F" history-incremental-search-forward
bindkey "^R" history-incremental-search-backward

if [[ -e $HOME/.aliases ]] ; then source $HOME/.aliases ; fi
if [[ -e $HOME/.privatealiases ]] ; then source $HOME/.privatealiases ; fi
if [[ -e $HOME/.privateer ]] ; then export PATH="$HOME/.privateer/bin:$PATH" ; fi
